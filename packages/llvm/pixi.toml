# naga-sycl-toolkit Workspace
# Intel DPC++ SYCL compiler with NVIDIA CUDA support
#
# ============================================================================
# WORKFLOW
# ============================================================================
#
# First time setup (creates recipe symlinks):
#   pixi run -e intel-init setup
#
# Build and install:
#   pixi install
#
# This builds three packages from one recipe:
#   - naga-sycl-toolkit-libs:  Runtime libraries only (libsycl.so, etc.)
#   - naga-sycl-toolkit-devel: Development files (headers, cmake modules)
#   - naga-sycl-toolkit:       Full toolkit with compiler and tools
#
# ============================================================================
# BUILD STRATEGY
# ============================================================================
#
# The build runs directly in the repo/ directory (not a copy) to enable
# incremental builds. Subsequent builds only recompile changed files.
# A full initial build takes ~30-60 minutes; incremental builds are much faster.
#
# ============================================================================

[workspace]
channels = ["https://prefix.dev/pixi-build-backends", "conda-forge"]
platforms = ["linux-64"]
preview = ["pixi-build"]

[system-requirements]
libc = "2.34"

# Install the full toolkit (which depends on devel -> libs)
[dependencies]
naga-sycl-toolkit = { path = "toolkit" }

# ============================================================================
# Init environment (no default feature - doesn't trigger package builds)
# ============================================================================
# This environment is used to set up recipe symlinks before the first build.
# The symlinks are a workaround until pixi-build-rattler-build supports
# custom recipe paths. See: https://github.com/prefix-dev/pixi-build-backends/issues/471

[feature.intel-init]
platforms = ["linux-64"]

[feature.intel-init.tasks]
setup = """
ln -sfn ../recipe libs/recipe && \
ln -sfn ../recipe devel/recipe && \
ln -sfn ../recipe toolkit/recipe && \
echo "Recipe symlinks created successfully"
"""

[environments]
intel-init = { features = ["intel-init"], no-default-feature = true }
