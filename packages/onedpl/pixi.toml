# naga-onedpl Workspace
# SYCL parallel algorithms library (header-only)
#
# ============================================================================
# WORKFLOW
# ============================================================================
#
# Initialize submodule:
#   pixi run -e init submodule-init
#
# Build and install:
#   pixi install
#
# This builds a single header-only package:
#   - naga-onedpl: Headers, cmake modules, and license
#
# ============================================================================
# BUILD STRATEGY
# ============================================================================
#
# oneDPL is header-only, so the "build" just runs CMake configure + install
# to generate proper CMake config files. No actual compilation needed.
#
# IMPORTANT: The AdaptiveCPP package must be built and installed first.
# The local channel is included to provide pre-built packages during build.
#
# ============================================================================


[workspace]
channels = [
  "https://prefix.dev/code-accelerate",
  "https://prefix.dev/pixi-build-backends",
  "conda-forge",
]
platforms = ["linux-64"]
preview = ["pixi-build"]

[package.build]
backend = { name = "pixi-build-rattler-build", version = "*", channels = [
  "https://prefix.dev/code-accelerate",
  "https://prefix.dev/conda-forge",
] }


[package.build.config]
experimental = false


[system-requirements]
libc = "2.34"

# Install the naga-onedpl package
[dependencies]
naga-onedpl = { path = "." }

# ============================================================================
# Init environment (no default feature - doesn't trigger package builds)
# ============================================================================

[feature.init]
platforms = ["linux-64"]

[feature.init.tasks]
submodule-init = """
cd ../.. && git submodule update --init packages/onedpl/repo
"""

[environments]
init = { features = ["init"], no-default-feature = true }
