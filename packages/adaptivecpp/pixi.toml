# naga-adaptivecpp-toolkit Workspace
# AdaptiveCpp SYCL compiler with NVIDIA CUDA support
#
# ============================================================================
# WORKFLOW
# ============================================================================
#
# First time setup (creates recipe symlinks):
#   pixi run -e acpp-init setup
#
# Build and install:
#   pixi install
#
# This builds three packages from one recipe:
#   - naga-adaptivecpp-toolkit-libs:  Runtime libraries only (libacpp-rt.so, etc.)
#   - naga-adaptivecpp-toolkit-devel: Development files (headers, cmake modules)
#   - naga-adaptivecpp-toolkit:       Full toolkit with compiler and tools
#
# ============================================================================
# BUILD STRATEGY
# ============================================================================
#
# The build runs directly in the repo/ directory (not a copy) to enable
# incremental builds. Subsequent builds only recompile changed files.
# A full initial build takes ~15-30 minutes; incremental builds are much faster.
#
# ============================================================================

[workspace]
channels = ["https://prefix.dev/pixi-build-backends", "conda-forge"]
platforms = ["linux-64"]
preview = ["pixi-build"]

[package.build]
backend = { name = "pixi-build-rattler-build", version = "*", channels = [
  "https://prefix.dev/conda-forge",
] }


[package.build.config]
experimental = false

[system-requirements]
libc = "2.34"

# Install the full toolkit (which depends on devel -> libs)
[dependencies]
naga-adaptivecpp-toolkit = { path = "toolkit" }

# ============================================================================
# Init environment (no default feature - doesn't trigger package builds)
# ============================================================================
# This environment is used to set up recipe symlinks before the first build.
# The symlinks are a workaround until pixi-build-rattler-build supports
# custom recipe paths. See: https://github.com/prefix-dev/pixi-build-backends/issues/471

[feature.acpp-init]
platforms = ["linux-64"]

[feature.acpp-init.tasks]
setup = """
ln -sfn ../recipe libs/recipe && \
ln -sfn ../recipe devel/recipe && \
ln -sfn ../recipe toolkit/recipe && \
echo "Recipe symlinks created successfully"
"""

[environments]
acpp-init = { features = ["acpp-init"], no-default-feature = true }
